# Плагины для загрузки ресурсов на сайте 4game.com

Все доступные плагины лежат в папке `/lib`. Все файлы, кроме `lib/loader.js`, являются стандартными [плагинами-загрузчиками для Require.js](http://requirejs.org/docs/plugins.html).

## block

Плагин для загрузки скриптов БЭМ-блоков на 4game: автоматически строит пути к блокам исходя из указанного имени. Если передано только название блока (например, `MyBlock`), плагин автоматически его продублирует, чтобы загружался файл `MyBlock/MyBlock.js`. Если в названии блока присутствует `/`, то имя не дублируется. Для каждого полученного адреса добавляется `prefix`, указанный в настройках плагина. 

Пример использования:

```js
require.config({
    config: {
        block: {
            prefix: '/path/to/blocks' // этот префикс будет добавлен ко всем модулям
        }
    }
});

require('block!MySuperBlock', function(block) {
    // загрузит %prefix%/MySuperBlock/MySuperBlock.js
});

require('block!MySuperBlock/submodule', function(block) {
    // загрузит %prefix%/MySuperBlock/submodule.js
});
```

## i18n

Загрузчик файлов для локализаци: выбирает путь к файлу исходя из настроек текущей страницы, а также от настроек префиксов, которые указываются в настройках модуля. По умолчанию в настройках в качестве префикса применяется ключ `default`. Для адресов вида `prefix/file` плагин сначала проверит, есть ли путь для ключа `prefix` в конфиге. Если есть, добавит к нему оставшуюся часть пути, если нет — просто добавит `default` в начале: ровно так же, как работает конфиг `paths` в Require.js.

В настройках путей можно задавать токены вида `%token_name%`, которые  автоматически будут вычисляться для каждого запроса. Пока поддерживается токен `%lang%`.

Пример использования:

```js
require.config({
    config: {
        i18n: {
            "default": "/r/js/i18n/%lang%/4game.com",
            "inn": "/r/js/i18n/%lang%/inn"
        }
    }
});

require('i18n!Interface', function() {
    // загрузит /r/js/i18n/%lang%/4game.com/Interface.php
    // токен %lang% достаётся из атрибута <html lang="..."> 
});

require('i18n!inn/User', function(block) {
    // загрузит /r/js/i18n/%lang%/inn/User.js
});
```

## text

Стандартный Require.js-плагин для загрузки текстовых файлов, смотри https://github.com/requirejs/text

## loader

Не является плагином как таковым, а надстройкой над стандартным механизмом загрузки файлов в Require.js. Перед загрузкой проверяет наличие файла на сервере и если его нет, пытается получить `main`-файл из файла `bower.json` или `package.json` и, если такой файл был найден, меняет внутренний маппинг модуля для того, чтобы относительные субмодули правильно подгружались с учётом найденного пути к пакету.

Также добавляет метод `requirejs.lookup()`, в который можно записать каталог версионированных зависимостей. Если запрашиваемый модуль есть в каталоге, он не будет проверяться на сервере.

Пример использования:

```js
require.config({
    paths: {
        packages: '/path/to/bower_components'
    }
});

require(['packages/jquery'], function($) {
    // загрузит файл /path/to/bower_components/jquery/bower.json, 
    // достанет из него значение секции `main` и в итоге
    // загрузит /path/to/bower_components/jquery/dist/jquery.js
});
```